<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="tool/jquery/jquery-ui-1.10.0/js/jquery-1.9.0.js"></script>
        <script type="text/javascript" src="tool/jquery/jquery-ui-1.10.0/js/jquery-ui-1.10.0.custom.js"></script>
        <!-- D3 -->
        <script type="text/javascript" src="tool/d3/d3.js"></script>
        <!--lumens-->
        <link rel="stylesheet" type="text/css" href="lumens/styles/lumens.css"/>
        <script type="text/javascript" src="lumens/controls.js"></script>
        <script type="text/javascript">
            jQuery(function() {
                // TODO ajax loading
                // TODO When scroll to bottom and then copllase the nodes, behaviour not correct
                // Tree is ok
                var dsTree = $('#tree');
                _canLog = false;
                tThis.loadData = function() {
                    // Make the data loading as a json
                    $.getJSON("./json/ds.json", function(json) {
                        dsTree.dynatree({
                            onCreate: function(node) {
                                if( !node.data.isFolder ) {
                                    $(node.span).draggable({
                                        appendTo: "#RightPane",
                                        helper: "clone"
                                    });
                                }
                            },
                            persist: true,
                            children: json.ds,
                            debugLevel:0
                        });
                    });
                }
                return;
                var rt = RuleTreeEditor.create({
                    holderId: "#rule-editor",
                    rightItemDropped: function(a, b) {
                        var path = a.name;
                        while(a.parent != undefined && a.parent.id > 1) {
                            path = a.parent.name + '.' + path;
                            a = a.parent;
                        }
                        if(b.path_array == undefined)
                            b.path_array = [];
                        b.path_array.push(path);
                        b.script = '@'+path;
                        $("#script").text(b.script);
                        $("#script").css("font-weight", "normal");
                    },
                    rightItemSelected: function(d) {

                    }
                });
                rt.loadData();

                $("#test").css({
                    "width": "100%",
                    "height": "100%"
                }).find("#rule-editor").trigger(jQuery.Event("resize"));

                $("#test").css({
                    "width": "900",
                    "height": "300"
                }).find("#rule-editor").trigger(jQuery.Event("resize"));
                $(window).on("resize", function(e){
                    if(e.target != this) return;
                    $("#rule-editor").trigger(jQuery.Event("resize"));
                });

            });
        </script>
    </head>
    <body>
        <div id="test" style="position: relative; width: 900px; height:400px;">
            <div id="rule-editor" style="width:100%; height:100%; overflow: hidden">
            </div>
        </div>
        <div id="script"></div>
    </body>
</html>
