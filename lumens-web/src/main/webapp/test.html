<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <!-- Page Specific CSS -->
        <link rel="stylesheet" href="libs/morris/morris.css">
        <!-- Bootstrap core CSS -->
        <link rel="stylesheet" href="app/css/lumens_boostrap.css">
        <link rel="stylesheet" href="app/css/lumens.css">
    </head>
    <body class="lumens" ng-app="lumensTest">
        <div id="id-main-view" ng-controller="MainTestCtrl"><test></test></div>
        <!-- JavaScript  -->
        <script src="libs/jquery/js/jquery.js"></script>
        <script src="libs/jquery/js/jquery-ui.js"></script>
        <script src="libs/boostrap/js/bootstrap.js"></script>
        <script src="libs/raphael/raphael-min.js"></script>
        <script src="libs/morris/morris.min.js"></script>
        <script src="libs/classy.js"></script>
        <script src="libs/base64.js"></script>

        <script src="app/bootstrap.js"></script>
        <script src="app/i18n/en_US.js"></script>
        <script src="app/js/layout.js"></script>
        <script src="app/js/sysheader.js"></script>
        <script src="app/js/navbar.js"></script>
        <script src="app/js/navmenu.js"></script>
        <script src="app/js/tab.js"></script>
        <script src="app/js/tree.js"></script>
        <script src="app/js/list.js"></script>
        <script src="app/js/component.js"></script>
        <script src="app/js/project.js"></script>
        <!-- Angular JS -->
        <script src="libs/angular/angular.js"></script>
        <script src="libs/angular/angular-resource.js"></script>
        <!-- Application Angular Modules -->
        <script src="app/mvp/directives.js"></script>
        <script type="text/javascript">
            Lumens.appModule = angular.module('lumensTest', ["lumens-directives"]);
            function MainTestCtrl($scope, $http, $compile, $sce) {
                $scope.currentComponent = {name: "to select"};
                var rootLayout = new Lumens.RootLayout($('#id-main-view')).configure();
                var theLayout = new Lumens.ResizableVSplitLayoutExt(rootLayout).configure({
                    mode: "vertical",
                    useRatio: true,
                    part1Size: "30%"
                });
                var topPanel = new Lumens.SplitLayout(theLayout.getPart1Element()).configure({
                    mode: "horizontal",
                    useRatio: true,
                    part1Size: "50%",
                    part2Size: "50%"
                });
                var leftPanel = new Lumens.Panel(topPanel.getPart1Element()).configure({
                    panelStyle: {width: "100%", height: "100%", overflow: "auto"}
                });
                var rightPanel = new Lumens.Panel(topPanel.getPart2Element()).configure({
                    panelStyle: {width: "100%", height: "100%", overflow: "auto"}
                });

                var tree = new Lumens.Tree(leftPanel.getElement()).configure({
                    dblclick: function(parent, current) {
                        if (current.hasContent() || !current.isFolder())
                            return;
                        current.addChildList(current.getLevel() > 3 ?
                        [
                            {
                                name: "[string]test" + current.getId(),
                                nodeType: "file"
                            },
                            {
                                name: "[int]test2" + current.getId(),
                                nodeType: "file"
                            }
                        ] :
                        [
                            {
                                name: "test" + current.getId(),
                                nodeType: "folder"
                            },
                            {
                                name: "test2" + current.getId(),
                                nodeType: "folder"
                            }
                        ]);
                    },
                    handler: function(parentNode) {
                        parentNode.addEntryList([
                            {
                                name: "test",
                                nodeType: "folder"
                            },
                            {
                                name: "test2",
                                nodeType: "folder"
                            }
                        ]);
                    },
                    draggable: true
                });
                $http.get("app/mock/json/data_source_category.json").success(function(data_source_category) {
                    $($compile('<div style="background-color: gray; width: 100px; height: 50px; top: 50px; left: 50px; position: relative; display: block;">Oracle</div>')($scope))
                    .appendTo(rightPanel.getElement())
                    .click(function() {
                        var currentComponentConfig = $(this).data("item-data");
                        console.log(currentComponentConfig);
                        $scope.$apply(function() {
                            if ($scope.project) {
                                $scope.project.name = "test click " + $scope.project.name;
                                $scope.currentComponent = $scope.project.datasource[0];
                                $scope.currentComponentConfig = currentComponentConfig;
                                $scope.componentI18N = currentComponentConfig.i18n;
                                $scope.componentForm = $compile(currentComponentConfig.html)($scope);
                                $scope.componentProps = {"Description": $scope.currentComponent.description};
                                if ($scope.currentComponent.property)
                                    $.each($scope.currentComponent.property, function() {
                                        $scope.componentProps[this.name] = this.value;
                                    })
                            }
                        })
                    }).data("item-data", data_source_category.items[1]);

                    $($compile('<div style="background-color: gray; width: 100px; height: 50px; top: 50px; left: 250px; position: relative; display: block;">SOAP</div>')($scope))
                    .appendTo(rightPanel.getElement())
                    .click(function() {
                        var currentComponentConfig = $(this).data("item-data");
                        console.log(currentComponentConfig);
                        $scope.$apply(function() {
                            if ($scope.project) {
                                $scope.project.name = "test click " + $scope.project.name;
                                $scope.currentComponent = $scope.project.datasource[1];
                                $scope.currentComponentConfig = currentComponentConfig;
                                $scope.componentI18N = currentComponentConfig.i18n;
                                $scope.componentForm = $compile(currentComponentConfig.html)($scope);
                                $scope.componentProps = {"Description": $scope.currentComponent.description};
                                if ($scope.currentComponent.property)
                                    $.each($scope.currentComponent.property, function() {
                                        $scope.componentProps[this.name] = this.value;
                                    })
                            }
                        })
                    }).data("item-data", data_source_category.items[0]);
                });

                $.get("app/mock/json/get_project.json", function(projectData) {
                    if (projectData.content && projectData.content.project && projectData.content.project.length > 0) {
                        $scope.project = $.parseJSON(projectData.content.project[0].data).project;
                    }
                });
                theLayout.getTitleElement().append($compile('<b>Project: {{project.name}}</b>')($scope));
                var tabsContainer = new Lumens.Panel(theLayout.getPart2Element()).configure({
                    panelStyle: {"height": "100%", "width": "100%", "overflow": "auto"}
                });
                function tabSummary($tabContent) {
                    var list = new Lumens.List($tabContent).configure({
                        IdList: [
                            "Description",
                            "Resources",
                            "Instruments"
                        ],
                        titleList: [
                            "Description",
                            "Resources",
                            "Instruments"
                        ],
                        buildContent: function(itemContent, isExpand, title) {
                            if (isExpand) {
                                var itemID = title.attr("id");
                                if (itemID === "Description") {
                                    $http.get("app/templates/project_desc_tmpl.html").success(function(project_desc_tmpl) {
                                        itemContent.append($compile(project_desc_tmpl)($scope));
                                    });
                                }
                                else if (itemID === "Resources") {
                                    $http.get("app/templates/resources_tmpl.html").success(function(resources_tmpl) {
                                        itemContent.append($compile(resources_tmpl)($scope));
                                    });
                                }
                                else if (itemID === "Instruments") {
                                    $http.get("app/templates/instruments_tmpl.html").success(function(instruments_tmpl) {
                                        itemContent.append($compile(instruments_tmpl)($scope));
                                    });
                                }
                            }
                        }
                    });
                }
                function tabProperties($tabContent) {
                    var list = new Lumens.List($tabContent).configure({
                        IdList: [
                            "ComponentProps"
                        ],
                        titleList: [
                        ],
                        buildContent: function(itemContent, isExpand, title, titleText) {
                            if (isExpand) {
                                var itemID = title.attr("id");
                                if (itemID === "ComponentProps") {
                                    titleText.append($compile('<span ng-model="currentComponent.name">{{currentComponent.name}}</span>')($scope));
                                    $http.get("app/templates/comp_props_form_tmpl.html").success(function(comp_props_form_tmpl) {
                                        itemContent.append($compile(comp_props_form_tmpl)($scope));
                                    });
                                }
                            }
                        }
                    });
                }
                var buttonBar = $('<div class="lumens-button-bar"><input type=button value="Save" /><input type=button value="Delete" /></div>').appendTo(tabsContainer.getElement());
                buttonBar.find('input[value="Save"]').click(function() {
                    console.log($scope);
                });
                var tabs = new Lumens.TabPanel(tabsContainer.getElement())
                .configure({
                    tab: [
                        {id: "id1", label: "Project Summary", content: tabSummary},
                        {id: "id2", label: "Component Properties", content: tabProperties},
                        {id: "id3", label: "Data Formats", content: undefined}
                    ],
                    activate: function(actived, activedContent) {
                        console.log(actived);
                        console.log(activedContent);
                    }
                });
            }
        </script>
    </body>
</html>
